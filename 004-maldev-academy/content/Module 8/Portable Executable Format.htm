<!DOCTYPE html>
<html class="dark"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie-edge">
        <meta name="csrf-token" content="aHzsquahomm2Bo0anbhiCgbZ1siEurCTfma8L6Pk">
        <link rel="stylesheet" href="Portable%20Executable%20Format_files/template.css">
        <link rel="shortcut icon" href="#favicon.ico">
        <!-- fontawesome for icons -->
        <link rel="stylesheet" href="Portable%20Executable%20Format_files/font-awesome.min.css">
        <!-- google fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com/">
        <link href="Portable%20Executable%20Format_files/css2.css" rel="stylesheet">
        <link href="Portable%20Executable%20Format_files/css2_002.css" rel="stylesheet">
        <title>Portable Executable Format</title>
        <!-- Custom css files, order matters -->
        <link rel="preload" as="style" href="Portable%20Executable%20Format_files/app.fdbb573b.css"><link rel="stylesheet" href="Portable%20Executable%20Format_files/app.fdbb573b.css"><link rel="stylesheet" href="Portable%20Executable%20Format_files/viewer.css">
    </head>
    <body>
        <nav id="navbar" class="px-2 sm:px-4 py-2.5 bg-gray-900 sticky hidden">
    <div class="container flex flex-wrap justify-between mx-auto">
      <a data-target="_self" href="#" class="flex items-center">
        <div class="main-logo flex flex-row items-center">
            <span class="text-xl logo-font text-white">MALDEV</span>
            <img class="w-[25px] mx-2 relative bottom-1" src="Portable%20Executable%20Format_files/logo-bug-2.png" alt="Logo">   
            <span class="text-xl logo-font text-white">ACADEMY</span>          
        </div>
      </a>
      <button data-collapse-toggle="navbar-default" id="navbar-phone-btn" type="button" class="inline-flex items-center p-2 ml-3 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-default" aria-expanded="false">
        <span class="sr-only">Open main menu</span>
        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
      </button>
      <div class="hidden w-full md:block md:w-auto" id="navbar-default">
        <ul class="flex flex-col items-center p-4 mt-4 bg-gray-50 rounded-lg border border-gray-100 md:flex-row md:space-x-8 md:mt-0 md:text-sm md:font-medium md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
          <li>
            <a data-target="_self" href="#" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Home</a>
          </li>
          <li>
            <a data-target="_self" href="#faq" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">FAQ</a>
          </li>
          <li>
            <a data-target="_self" href="#syllabus" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Syllabus</a>
          </li>
                              <li>
            <a data-target="_self" href="#pricing" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Pricing</a>
          </li>
                                        <li>
            <a data-target="_self" href="#profile" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Profile</a>
          </li>
          <li>
            <form action="#logout" method="POST">
            <input type="hidden" name="_token" value="aHzsquahomm2Bo0anbhiCgbZ1siEurCTfma8L6Pk">              <button type="submit" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Logout</button>
            </form>
          </li>
          <li class="mt-4 md:mt-0">
            <a data-target="_self" href="#modules" class="text-white bg-blue-700 hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center md:mr-3 mr-0 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Modules</a>
          </li>
                  </ul>
      </div>
    </div>
  </nav>        <div class="bg-gray-900 p-4">
    <div class="flex">
        <div class="md:flex-row flex-col flex md:items-center w-1/2 bg-gray-700 border-l border-t border-gray-600 pl-4 pt-2 pb-2 rounded-tl">
            <div>
                Module 8 - Portable Executable Format
            </div>
            <div class="ml-2 w-4 h-4 bg-green-800 rounded-full"></div>
        </div>
        <div class="flex justify-end items-center w-1/2 bg-gray-700 pr-4 pt-2 pb-2 rounded-tr border-t border-r border-gray-600">
            <div class="enlarge-container pr-4">
                <img src="Portable%20Executable%20Format_files/enlarge.svg" onclick="toggleScreenWidth()" class="hover:bg-gray-600 rounded-sm cursor-pointer" id="enlargeToggle" alt="Screen Width" width="20px">
            </div>
            <div class="objectives-container pr-4">
                <img src="Portable%20Executable%20Format_files/objectives.svg" onclick="toggleObjectives()" class="hover:bg-gray-600 cursor-pointer" id="objectivesToggle" alt="Objectives" width="20px">
            </div>
            <div class="terminal-container ">
                <img src="Portable%20Executable%20Format_files/ide.svg" onclick="toggleIde()" class="hover:bg-gray-600 rounded-sm cursor-pointer" id="terminalToggle" alt="Terminal" width="22px">
            </div>
                    </div>
    </div>
    <div id="height-container" class="flex h-full min-h-[800px]">
        <div class="flex max-w-full min-w-full">
            <div id="description-container" class="viewer code-description h-full bg-gray-800 p-4 border-r border-l border-b border-gray-600 px-5 md:px-10 lg:px-20 w-full"><div class="toastui-editor-contents" style="overflow-wrap: break-word;">
            <h2>Portable Executable Format</h2>
<h3>Introduction</h3>
<p>Portable Executable (PE) is the file format for executables on Windows. A few examples of PE file extensions are <code>.exe</code>, <code>.dll</code>, <code>.sys</code> and <code>.scr</code>. This module discusses the PE structure which is important to know when building or reverse engineering malware.</p>
<p>Note that this module and future modules will often interchangeably refer to executables (e.g. EXEs, DLLs) as "Images".</p>
<h3>PE Structure</h3>
<p>The diagram below shows a simplified structure of a Portable 
Executable. Every header shown in the image is defined as a data 
structure that holds information about the PE file. Each data structure 
will be explained in detail in this module.</p>
<p><img src="Portable%20Executable%20Format_files/pe-structure.png" alt="image"></p>
<br>
<h4>DOS Header (IMAGE_DOS_HEADER)</h4>
<p>This first header of a PE file is always prefixed with two bytes, <code>0x4D</code> and <code>0x5A</code>, commonly referred to as <code>MZ</code>.
 These bytes represent the DOS header signature, which is used to 
confirm that the file being parsed or inspected is a valid PE file. The 
DOS header is a data structure, defined as follows:</p>
<pre><code>typedef struct _IMAGE_DOS_HEADER {      // DOS .EXE header
    WORD   e_magic;                     // Magic number
    WORD   e_cblp;                      // Bytes on last page of file
    WORD   e_cp;                        // Pages in file
    WORD   e_crlc;                      // Relocations
    WORD   e_cparhdr;                   // Size of header in paragraphs
    WORD   e_minalloc;                  // Minimum extra paragraphs needed
    WORD   e_maxalloc;                  // Maximum extra paragraphs needed
    WORD   e_ss;                        // Initial (relative) SS value
    WORD   e_sp;                        // Initial SP value
    WORD   e_csum;                      // Checksum
    WORD   e_ip;                        // Initial IP value
    WORD   e_cs;                        // Initial (relative) CS value
    WORD   e_lfarlc;                    // File address of relocation table
    WORD   e_ovno;                      // Overlay number
    WORD   e_res[4];                    // Reserved words
    WORD   e_oemid;                     // OEM identifier (for e_oeminfo)
    WORD   e_oeminfo;                   // OEM information; e_oemid specific
    WORD   e_res2[10];                  // Reserved words
    LONG   e_lfanew;                    // Offset to the NT header
  } IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;
</code></pre>
<p>The most important members of the struct are <code>e_magic</code> and <code>e_lfanew</code>.</p>
<p><code>e_magic</code> is 2 bytes with a fixed value of <code>0x5A4D</code> or <code>MZ</code>.</p>
<p><code>e_lfanew</code> is a 4-byte value that holds an offset to the start of the NT Header. Note that <code>e_lfanew</code> is always located at an offset of <code>0x3C</code>.</p>
<h4>DOS Stub</h4>
<p>Before moving on to the NT header structure, there is the DOS stub 
which is an error message that prints "This program cannot be run in DOS
 mode" in case the program is loaded in <a href="https://en.wikipedia.org/wiki/DOS" target="_blank">DOS mode</a>
 or "Disk Operating Mode". It is worth noting that the error message can
 be changed by the programmer at compile time. This is not a PE header, 
but it's good to be aware of it.</p>
<h4>NT Header (IMAGE_NT_HEADERS)</h4>
<p>The NT header is essential as it incorporates two other image headers: <code>FileHeader</code> and <code>OptionalHeader</code>,
 which include a large amount of information about the PE file. 
Similarly to the DOS header, the NT header contains a signature member 
that is used to verify it. Usually, the signature element is equal to 
the "PE" string, which is represented by the <code>0x50</code> and <code>0x45</code> bytes. But since the signature is of data type <code>DWORD</code>, the signature will be represented as <code>0x50450000</code>, which is still "PE", except that it is padded with two null bytes. The NT header can be reached using the <code>e_lfanew</code> member inside of the DOS Header.</p>
<p>The NT header structure varies depending on the machine's architecture.</p>
<p><strong>32-bit Version:</strong></p>
<pre><code>typedef struct _IMAGE_NT_HEADERS {
  DWORD                   Signature;
  IMAGE_FILE_HEADER       FileHeader;
  IMAGE_OPTIONAL_HEADER32 OptionalHeader;
} IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;
</code></pre>
<p><strong>64-bit Version:</strong></p>
<pre><code>typedef struct _IMAGE_NT_HEADERS64 {
    DWORD                   Signature;
    IMAGE_FILE_HEADER       FileHeader;
    IMAGE_OPTIONAL_HEADER64 OptionalHeader;
} IMAGE_NT_HEADERS64, *PIMAGE_NT_HEADERS64;
</code></pre>
<p>The only difference is the <code>OptionalHeader</code> data structure, <code>IMAGE_OPTIONAL_HEADER32</code> and <code>IMAGE_OPTIONAL_HEADER64</code>.</p>
<h4>File Header (IMAGE_FILE_HEADER)</h4>
<p>Moving on to the next header, which can be accessed from the previous NT Header data structure</p>
<pre><code>typedef struct _IMAGE_FILE_HEADER {
  WORD  Machine;
  WORD  NumberOfSections;
  DWORD TimeDateStamp;
  DWORD Pointer#ymbolTable;
  DWORD NumberOfSymbols;
  WORD  SizeOfOptionalHeader;
  WORD  Characteristics;
} IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;
</code></pre>
<p>The most important struct members are:</p>
<ul>
<li>
<p><code>NumberOfSections</code> - The number of sections in the PE file (discussed later).</p>
</li>
<li>
<p><code>Characteristics</code> -  Flags that specify certain attributes
 about the executable file, such as whether it is a dynamic-link library
 (DLL) or a console application.</p>
</li>
<li>
<p><code>SizeOfOptionalHeader</code> - The size of the following optional header</p>
</li>
</ul>
<p>Additional information about the file header can be found on the <a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_file_header" target="_blank">official documentation page</a>.</p>
<h4>Optional Header (IMAGE_OPTIONAL_HEADER)</h4>
<p>The optional header is important and although it's called "optional",
 it's essential for the execution of the PE file. It is referred to as 
optional because some file types do not have it.</p>
<p>The optional header has two versions, a version for 32-bit and 64-bit
 systems. Both versions have nearly identical members in their data 
structure with the main difference being the size of some members. <code>ULONGLONG</code> is used in the 64-bit version and <code>DWORD</code> in the 32-bit version. Additionally, the 32-bit version has some members which are not found in the 64-bit version.</p>
<p><strong>32-bit Version:</strong></p>
<pre><code>typedef struct _IMAGE_OPTIONAL_HEADER {
  WORD                 Magic;
  BYTE                 MajorLinkerVersion;
  BYTE                 MinorLinkerVersion;
  DWORD                SizeOfCode;
  DWORD                SizeOfInitializedData;
  DWORD                SizeOfUninitializedData;
  DWORD                AddressOfEntryPoint;
  DWORD                BaseOfCode;
  DWORD                BaseOfData;
  DWORD                ImageBase;
  DWORD                SectionAlignment;
  DWORD                FileAlignment;
  WORD                 MajorOperatingSystemVersion;
  WORD                 MinorOperatingSystemVersion;
  WORD                 MajorImageVersion;
  WORD                 MinorImageVersion;
  WORD                 MajorSubsystemVersion;
  WORD                 MinorSubsystemVersion;
  DWORD                Win32VersionValue;
  DWORD                SizeOfImage;
  DWORD                SizeOfHeaders;
  DWORD                CheckSum;
  WORD                 Subsystem;
  WORD                 DllCharacteristics;
  DWORD                SizeOfStackReserve;
  DWORD                SizeOfStackCommit;
  DWORD                SizeOfHeapReserve;
  DWORD                SizeOfHeapCommit;
  DWORD                LoaderFlags;
  DWORD                NumberOfRvaAndSizes;
  IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
} IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;
</code></pre>
<p><strong>64-bit Version:</strong></p>
<pre><code>typedef struct _IMAGE_OPTIONAL_HEADER64 {
  WORD                 Magic;
  BYTE                 MajorLinkerVersion;
  BYTE                 MinorLinkerVersion;
  DWORD                SizeOfCode;
  DWORD                SizeOfInitializedData;
  DWORD                SizeOfUninitializedData;
  DWORD                AddressOfEntryPoint;
  DWORD                BaseOfCode;
  ULONGLONG            ImageBase;
  DWORD                SectionAlignment;
  DWORD                FileAlignment;
  WORD                 MajorOperatingSystemVersion;
  WORD                 MinorOperatingSystemVersion;
  WORD                 MajorImageVersion;
  WORD                 MinorImageVersion;
  WORD                 MajorSubsystemVersion;
  WORD                 MinorSubsystemVersion;
  DWORD                Win32VersionValue;
  DWORD                SizeOfImage;
  DWORD                SizeOfHeaders;
  DWORD                CheckSum;
  WORD                 Subsystem;
  WORD                 DllCharacteristics;
  ULONGLONG            SizeOfStackReserve;
  ULONGLONG            SizeOfStackCommit;
  ULONGLONG            SizeOfHeapReserve;
  ULONGLONG            SizeOfHeapCommit;
  DWORD                LoaderFlags;
  DWORD                NumberOfRvaAndSizes;
  IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
} IMAGE_OPTIONAL_HEADER64, *PIMAGE_OPTIONAL_HEADER64;
</code></pre>
<p>The optional header contains a ton of information that can be used. Below are some of the struct members that are commonly used:</p>
<ul>
<li>
<p><code>Magic</code> - Describes the state of the image file (32 or 64-bit image)</p>
</li>
<li>
<p><code>MajorOperatingSystemVersion</code> - The major version number of the required operating system (e.g. 11, 10)</p>
</li>
<li>
<p><code>MinorOperatingSystemVersion</code> - The minor version number of the required operating system (e.g. 1511, 1507, 1607)</p>
</li>
<li>
<p><code>SizeOfCode</code> - The size of the <code>.text</code> section (Discussed later)</p>
</li>
<li>
<p><code>AddressOfEntryPoint</code> - Offset to the entry point of the file (Typically the <em>main</em> function)</p>
</li>
<li>
<p><code>BaseOfCode</code> - Offset to the start of the <code>.text</code> section</p>
</li>
<li>
<p><code>SizeOfImage</code> - The size of the image file in bytes</p>
</li>
<li>
<p><code>ImageBase</code> - It specifies the preferred address at which 
the application is to be loaded into memory when it is executed. 
However, due to Window's memory protection mechanisms like Address Space
 Layout Randomization (ASLR), it's rare to see an image mapped to its 
preferred address because the Windows PE Loader maps the file to a 
different address. This random allocation done by the Windows PE loader 
will cause issues in the implementation of future techniques because 
some addresses that are considered constant were changed. The Windows PE
 loader will then go through <em>PE relocation</em> to fix these addresses.</p>
</li>
<li>
<p><code>DataDirectory</code> - One of the most important members in the optional header. This is an array of <a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_data_directory" target="_blank">IMAGE_DATA_DIRECTORY</a>, which contains the directories in a PE file (discussed below).</p>
</li>
</ul>
<h5>Data Directory</h5>
<p>The Data Directory can be accessed from the optional's header last member. This is an array of data type <code>IMAGE_DATA_DIRECTORY</code> which has the following data structure:</p>
<pre><code>typedef struct _IMAGE_DATA_DIRECTORY {
    DWORD   VirtualAddress;
    DWORD   Size;
} IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;
</code></pre>
<p>The Data Directory array is of size <code>IMAGE_NUMBEROF_DIRECTORY_ENTRIES</code> which is a constant value of <code>16</code>.
 Each element in the array represents a specific data directory which 
includes some data about a PE section or a Data Table (the place where 
specific information about the PE is saved).</p>
<p>A specific data directory can be accessed using its index in the array.</p>
<pre><code>#define IMAGE_DIRECTORY_ENTRY_EXPORT          0   // Export Directory
#define IMAGE_DIRECTORY_ENTRY_IMPORT          1   // Import Directory
#define IMAGE_DIRECTORY_ENTRY_RESOURCE        2   // Resource Directory
#define IMAGE_DIRECTORY_ENTRY_EXCEPTION       3   // Exception Directory
#define IMAGE_DIRECTORY_ENTRY_SECURITY        4   // Security Directory
#define IMAGE_DIRECTORY_ENTRY_BASERELOC       5   // Base Relocation Table
#define IMAGE_DIRECTORY_ENTRY_DEBUG           6   // Debug Directory
#define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE    7   // Architecture Specific Data
#define IMAGE_DIRECTORY_ENTRY_GLOBALPTR       8   // RVA of GP
#define IMAGE_DIRECTORY_ENTRY_TLS             9   // TLS Directory
#define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG    10   // Load Configuration Directory
#define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT   11   // Bound Import Directory in headers
#define IMAGE_DIRECTORY_ENTRY_IAT            12   // Import Address Table
#define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT   13   // Delay Load Import Descriptors
#define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14   // COM Runtime descriptor
</code></pre>
<p>The two sections below will briefly mention two important data directories, the <code>Export Directory</code> and <code>Import Address Table</code>.</p>
<h5>Export Directory</h5>
<p>A PE's export directory is a data structure that contains information
 about functions and variables that are exported from the executable. It
 contains the addresses of the exported functions and variables, which 
can be used by other executable files to access the functions and data. 
The export directory is generally found in DLLs that export functions 
(e.g. <code>kernel32.dll</code> exporting <code>CreateFileA</code>).</p>
<h5>Import Address Table</h5>
<p>The import address table is a data structure in a PE that contains 
information about the addresses of functions imported from other 
executable files. The addresses are used to access the functions and 
data in the other executables (e.g. <code>Application.exe</code> importing <code>CreateFileA</code> from <code>kernel32.dll</code>).</p>
<h4>PE Sections</h4>
<p>PE sections contain the code and data used to create an executable 
program. Each PE section is given a unique name and typically contains 
executable code, data, or resource information. There is no constant 
number of PE sections because different compilers can add, remove or 
merge sections depending on the configuration. Some sections can also be
 added later on manually, therefore it is dynamic and the <code>IMAGE_FILE_HEADER.NumberOfSections</code> helps determine that number.</p>
<p>The following PE sections are the most important ones and exist in almost every PE.</p>
<ul>
<li>
<p><code>.text</code> - Contains the executable code which is the written code.</p>
</li>
<li>
<p><code>.data</code> - Contains initialized data which are variables initialized in the code.</p>
</li>
<li>
<p><code>.rdata</code> - Contains read-only data. These are constant variables prefixed with <code>const</code>.</p>
</li>
<li>
<p><code>.idata</code> - Contains the import tables. These are tables of
 information related to the functions called using the code. This is 
used by the Windows PE Loader to determine which DLL files to load to 
the process, along with what functions are being used from each DLL.</p>
</li>
<li>
<p><code>.reloc</code> - Contains information on how to fix up memory addresses so that the program can be loaded into memory without any errors.</p>
</li>
<li>
<p><code>.rsrc</code> - Used to store resources such as icons and bitmaps</p>
</li>
</ul>
<p>Each PE section has an <a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_section_header" target="_blank">IMAGE_SECTION_HEADER</a>
 data structure that contains valuable information about it. These 
structures are saved under the NT headers in a PE file and are stacked 
above each other where each structure represents a section.</p>
<p>Recall, the IMAGE_SECTION_HEADER structure is as follows:</p>
<pre><code>typedef struct _IMAGE_SECTION_HEADER {
  BYTE  Name[IMAGE_SIZEOF_SHORT_NAME];
  union {
    DWORD PhysicalAddress;
    DWORD VirtualSize;
  } Misc;
  DWORD VirtualAddress;
  DWORD SizeOfRawData;
  DWORD PointerToRawData;
  DWORD PointerToRelocations;
  DWORD PointerToLinenumbers;
  WORD  NumberOfRelocations;
  WORD  NumberOfLinenumbers;
  DWORD Characteristics;
} IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;
</code></pre>
<p>looking at the elements, every single one is highly valuable and important:</p>
<ul>
<li>
<p><code>Name</code> - The name of the section. (e.g. .text, .data, .rdata).</p>
</li>
<li>
<p><code>PhysicalAddress</code> or <code>VirtualSize</code> - The size of the section when it is in memory.</p>
</li>
<li>
<p><code>VirtualAddress</code> - Offset of the start of the section in memory.</p>
</li>
</ul>
<h3>Additional References</h3>
<p>In case further clarification is required on certain sections, the following blog posts on <a href="https://0xrick.github.io/" target="_blank">0xRick's Blog</a> are highly recommended.</p>
<ul>
<li>
<p>PE Overview - <a href="https://0xrick.github.io/win-internals/pe2/" target="_blank">https://0xrick.github.io/win-internals/pe2/</a></p>
</li>
<li>
<p>DOS Header, DOS Stub and Rich Header - <a href="https://0xrick.github.io/win-internals/pe3/" target="_blank">https://0xrick.github.io/win-internals/pe3/</a></p>
</li>
<li>
<p>NT Headers - <a href="https://0xrick.github.io/win-internals/pe4/" target="_blank">https://0xrick.github.io/win-internals/pe4/</a></p>
</li>
<li>
<p>Data Directories, Section Headers and Sections - <a href="https://0xrick.github.io/win-internals/pe5/" target="_blank">https://0xrick.github.io/win-internals/pe5/</a></p>
</li>
<li>
<p>PE Imports (Import Directory Table, ILT, IAT) - <a href="https://0xrick.github.io/win-internals/pe6/" target="_blank">https://0xrick.github.io/win-internals/pe6/</a></p>
</li>
</ul>
<h3>Conclusion</h3>
<p>Understanding PE headers might be challenging the first time they are
 encountered. Luckily, none of the basic modules require an in-depth 
understanding of the PE structure. However, to make the malware perform 
more complex techniques, it will require a better understanding as some 
of the code requires parsing the PE file's headers and sections. This 
will likely be seen in intermediate and advanced modules.</p>

            </div></div>
            <div id="accessory-container" class="hidden flex flex-col w-1/4 min-w-1/4 h-full">
                <div id="objectives" class="hidden p-4 border-r border-b bg-gray-900 border-gray-600 font-code w-full h-1/2">
                    <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Objectives</div>
                                                                        
                                                                        
            <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-0" data-objective-id="0" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Open any EXE file with PE-Bear, click 'DOS Header' and locate the bytes 0x4D and 0x5A</label>
                            </div>
                                                                        
                                                                        
                    <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-1" data-objective-id="1" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Find the value of 'e_lfanew' (Hint: Look for the offset 0x3C)</label>
                            </div>
                                                                        
                                                                        
                    <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-2" data-objective-id="2" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Under
 the 'File Hdr' tab in PE-Bear, look at the value of 'Sections Count'. 
Verify that number with the number of sections in the 'Sections Hdrs' 
tab.</label>
                            </div>
                                                                        
                                                                        
                    <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-3" data-objective-id="3" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">View the imported DLLs and Windows APIs under the 'Imports' tab</label>
                            </div>
                                                                                  
                </div>
                <div id="ide" class="hidden p-4 border-r border-b border-gray-600 font-code w-full h-1/2">
                    <textarea class="bg-gray-900 outline-0 w-full h-full resize-none font-sans" placeholder="Write temporary notes or code here"></textarea>
                </div>
            </div>  
        </div>
      </div>
      <div class="flex">
        <div class="flex flex-row flex-wrap justify-center items-center w-full bg-gray-700 border-r border-l border-gray-600 pl-4 pt-2 pb-2 rounded-bl rounded-br">
                        <div class="mr-2">
                <a data-target="_self" href="#modules/7"><button class="w-[100px] h-10 px-5 text-sm duration-150 text-white bg-blue-700 hover:bg-blue-800 rounded-lg focus:shadow-outline">Previous</button></a>           
            </div>
                        <div class="mr-2">
                <a data-target="_self" href="#modules"><button class="w-[100px] h-10 px-5 text-sm duration-150 text-white bg-blue-700 hover:bg-blue-800 rounded-lg focus:shadow-outline">Modules</button></a>           
            </div>
            <div class="my-2 mr-2">
            <form id="complete-module" action="#modules/8/complete" method="POST">
                <input type="hidden" name="_token" value="aHzsquahomm2Bo0anbhiCgbZ1siEurCTfma8L6Pk">                <button id="complete-btn" class="w-[100px] h-10 px-5 text-white text-sm duration-150 bg-green-700 rounded-lg focus:shadow-outline hover:bg-green-800 hidden">Complete</button>
            </form>
            <form id="uncomplete-module" action="#modules/8/progress" method="POST">
                <input type="hidden" name="_token" value="aHzsquahomm2Bo0anbhiCgbZ1siEurCTfma8L6Pk">                <button id="uncomplete-btn" class="w-[100px] h-10 px-5 text-white text-sm duration-150 bg-red-700 rounded-lg focus:shadow-outline hover:bg-red-800 ">Undo</button>
            </form>
            </div>
                                    <div class="mr-2">
                <a data-target="_self" href="#modules/9"><button class="w-[100px] h-10 px-5 text-sm duration-150 text-white bg-blue-700 hover:bg-blue-800 rounded-lg focus:shadow-outline">Next</button></a>           
            </div>
                    </div>
    </div>
</div>

<footer id="footer" class="text-gray-400 border-t-[1px] border-gray-700 bg-gray-900 body-font hidden">
    <div class="container px-5 py-8 mx-auto flex items-center sm:flex-row flex-col">
      <p class="text-sm text-gray-400 sm:ml-4 sm:pl-4 sm:border-gray-800 sm:py-2 sm:mt-0 mt-4">© 2023 MalDev Academy</p>
        <a href="#" target="_blank" class="text-gray-500 hover:text-white ml-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg>
        </a>
      <span class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start">
        <a class="text-gray-400 text-sm" href="/" target="_blank">
#      </a></span><a class="text-gray-400 text-sm" href="/" target="_blank">
    </a></div><a class="text-gray-400 text-sm" href="/" target="_blank">
  </a></footer><a class="text-gray-400 text-sm" href="/" target="_blank">        

        <script src="Portable%20Executable%20Format_files/jquery-3.6.0.min.js"></script>
        <script src="Portable%20Executable%20Format_files/bootstrap.min.js"></script>
        <link rel="preload" as="style" href="Portable%20Executable%20Format_files/app.4474f4d1.css"><link rel="modulepreload" href="Portable%20Executable%20Format_files/app.5f3af5ce.js"><link rel="stylesheet" href="Portable%20Executable%20Format_files/app.4474f4d1.css"><script type="module" src="Portable%20Executable%20Format_files/app.5f3af5ce.js"></script><script src="Portable%20Executable%20Format_files/navbar.js"></script>
<script src="Portable%20Executable%20Format_files/moduleviewer.js"></script>

 
<script>
$(document).ready(function() {
    $('a:not([data-target="_self"])').attr('target', '_blank');

    $('input[type=checkbox]').change(function() {
    var checked = $(this).is(':checked');
    var userId = 260;
    var moduleId = 8;
    var objectiveId = $(this).data('objective-id');
    $.ajax({
        url: checked ? "#complete/objective" : "#remove/objective",
        type: "POST",
        data: {
        _token: "aHzsquahomm2Bo0anbhiCgbZ1siEurCTfma8L6Pk",
        user_id: userId,
        module_id: moduleId,
        objective_id: objectiveId
        },
        success: function(response) {

        },
        error: function(xhr) {
        console.log('Error');
        }
    });
    });

    $('#complete-module').submit(function(event) {
    event.preventDefault(); // Prevent default form submission

    var form = $(this);
    var url = form.attr('action');
    var data = form.serialize();
    var completeBtn = form.find('#complete-btn');
    var uncompleteBtn = $('#uncomplete-btn');

    $.ajax({
        type: 'POST',
        url: url,
        data: data,
        success: function(response) {
            completeBtn.addClass('hidden');
            uncompleteBtn.removeClass('hidden');
        },
        error: function(xhr) {
            console.log('Error');
        }
    });
});

$('#uncomplete-module').submit(function(event) {
    event.preventDefault(); // Prevent default form submission

    var form = $(this);
    var url = form.attr('action');
    var data = form.serialize();
    var completeBtn = $('#complete-btn');
    var uncompleteBtn = form.find('#uncomplete-btn');

    $.ajax({
        type: 'POST',
        url: url,
        data: data,
        success: function(response) {
            uncompleteBtn.addClass('hidden');
            completeBtn.removeClass('hidden');
        },
        error: function(xhr) {
            console.log('Error');
        }
    });
});
});
</script>
    
</a></body></html>